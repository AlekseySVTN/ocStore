<modification>

	<id>Change Add to Cart button when product is Out of Stock</id>
	<version>1.2.1</version>
	<vqmver>1.0.8</vqmver>
	<author>Created by Qphoria, modified by Vytas</author>
	
	<!-- v1.2.0 2012.02.02 vytasm - (OpenCart v1.5.1.3)
		- Works on all standard theme places (I hope) where "Add to cart" button appears
		- When item quantity is 0 then "Add to cart" button is disabled and label is changed to "Out of stock".  
		  When item quantity is less than 0 (ex. -1), then "Add to cart" button is enabled and label is changed to "Pre-Order". 
		  This allows add items into cart and checkout if checkout is enabled when item is out of stock (Admin -> System -> Settings -> (Select shop) -> Option -> set "YES" for "Stock Checkout")
		 v1.2.1 2012.02.06 vytasm - (OpenCart v1.5.1.3)
		- Bugfix: fixed problem in few modules when button was in Pre-Order state was not possible to add items to Cart.
	-->
    
	<!-- 
		########### IMPORTANT! ############ 
		Clone this block for each additional language
		You need to change file name. Example for german: "catalog/language/german/german.php"
	-->
	<file name="catalog/language/russian/russian.php">
        <operation error="skip"><!-- v14x -->
            <search position="before"><![CDATA[
            ?>
            ]]></search>
            <add trim="true"><![CDATA[
            $_['button_out_of_stock']   = 'Нет в наличии';
			$_['button_pre_order']      = 'Pre-Order';
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Product Controller Mod -->	
	<file name="catalog/controller/product/product.php">
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
				if ((float)$result['quantity']) { $quantity = (int)$result['quantity'];	} 
				else { $quantity = false; }
				]]></add>
        </operation>
		
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			'href'    	 => $this->url->link('product/product', 'product_id=' . $result['product_id']),
			]]></search>
            <add trim="true"><![CDATA[
			'quantity'	  => $quantity,
			]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from product pages -->
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<operation error="skip"><!-- v15x -->
            <search position="replace"><![CDATA[
            <a id="button-cart" class="button"><span><?php echo $button_cart; ?></span></a>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product_info['quantity'] == 0 || ($product_info['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a>
			<?php } elseif ($product_info['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<a id="button-cart" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a>
			<?php } else { ?>
			<a id="button-cart" class="button"><span><?php echo $button_cart; ?></span></a>
			<?php } ?>
            ]]></add>
        </operation>
		<operation error="skip"><!-- v15x -->
            <search position="after" offset="19"><![CDATA[
            <div id="tab-related" class="tab-content">
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
		<operation error="skip"><!-- v15x -->
            <search position="replace" index="2"><![CDATA[
            <a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Manufacturer Controller Mod -->	
	<file name="catalog/controller/product/manufacturer.php">
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
				if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
				]]></add>
        </operation>
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			'href'        => $this->url->link('product/product', $url . '&manufacturer_id=' . $result['manufacturer_id'] . '&product_id=' . $result['product_id'])
			]]></search>
            <add trim="true"><![CDATA[
			'quantity'	  => $quantity,
			]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from manufacturer product list -->
	<file name="catalog/view/theme/*/template/product/manufacturer_info.tpl">
		<operation error="skip"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	
	<!-- Compare Controller Mod -->	
	<file name="catalog/controller/product/compare.php">
		<operation error="skip"><!-- v15x -->
            <search position="after"><![CDATA[
			$this->data['products'][$product_id] = array(
			]]></search>
            <add trim="true"><![CDATA[
			'quantity'	  => $product_info['quantity'],
			]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from product compare list -->
	<file name="catalog/view/theme/*/template/product/compare.tpl">
		<operation error="skip"><!-- v15x -->
            <search position="replace"><![CDATA[
            <td><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></td>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<td><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></td>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<td><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></td>
			<?php } else { ?>
			<td><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></td>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Wishlist Controller Mod -->	
	<file name="catalog/controller/account/wishlist.php">
		<operation error="skip"><!-- v15x -->
            <search position="after"><![CDATA[
			$this->data['products'][] = array(
			]]></search>
            <add trim="true"><![CDATA[
			'quantity'	  => $product_info['quantity'],
			]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from product compare list -->
	<file name="catalog/view/theme/*/template/account/wishlist.tpl">
		<operation error="skip"><!-- v15x -->
            <search position="replace"><![CDATA[
            <td class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></td>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<td class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></td>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<td class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></td>
			<?php } else { ?>
			<td class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></td>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	
	<!-- Category Controller Mod -->	
	<file name="catalog/controller/product/category.php">
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
	if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
				]]></add>
        </operation>
		<operation error="skip"><!-- v15x -->
            <search position="before"><![CDATA[
			'href'        => $this->url->link('product/product', 'path=' . $this->request->get['path'] . '&product_id=' . $result['product_id'])
			]]></search>
            <add trim="true"><![CDATA[
	'quantity'	  => $quantity,
				]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Category Pages -->	
	<file name="catalog/view/theme/*/template/product/category.tpl">
		<operation error="skip"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout') ) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->

	<!-- Controller/Search Mod -->	
	<file name="catalog/controller/product/search.php">
		<operation><!-- v15x -->
            <search position="before"><![CDATA[
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
	if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
				]]></add>
        </operation>
		<operation><!-- v15x -->
            <search position="before"><![CDATA[
			'href'        => $this->url->link('product/product', $url . '&product_id=' . $result['product_id'])
			]]></search>
            <add trim="true"><![CDATA[
	'quantity'	  => $quantity,
				]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Search Pages -->	
	<file name="catalog/view/theme/*/template/product/search.tpl">
		<operation><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout')) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Featured Controller Mod -->	
	<file name="catalog/controller/module/featured.php">
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[	
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
				if ((float)$product_info['quantity']) {
					$quantity = (int)$product_info['quantity'];
				} else {
					$quantity = false;
				}
				]]></add>
        </operation>		
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[
			'href'    	 => $this->url->link('product/product', 'product_id=' . $product_info['product_id']),
			]]></search>
            <add trim="true"><![CDATA[	'quantity' => $quantity,	]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Featured Module -->	
	<file name="catalog/view/theme/*/template/module/featured.tpl">
		<operation error="log"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout') ) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->

	<!-- Latest Controller Mod -->
	<file name="catalog/controller/module/latest.php">
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[ if ($this->config->get('config_review_status')) { ]]></search>
            <add trim="true"><![CDATA[
				if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
			]]></add>
        </operation>
		
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[ 'href'    	 => $this->url->link('product/product', 'product_id=' . $result['product_id']), ]]></search>
            <add trim="true"><![CDATA[ 'quantity'   => $quantity, ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Latest Module -->
	<file name="catalog/view/theme/*/template/module/latest.tpl">
		<operation error="log"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout') ) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Special Controller Module -->
	<file name="catalog/controller/module/special.php">
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[ if ($this->config->get('config_review_status')) { ]]></search>
            <add trim="true"><![CDATA[
				if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
			]]></add>
        </operation>
		
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[ 'href'    	 => $this->url->link('product/product', 'product_id=' . $result['product_id']), ]]></search>
            <add trim="true"><![CDATA[ 'quantity'   => $quantity, ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Special Module -->
	<file name="catalog/view/theme/*/template/module/special.tpl">
		<operation error="log"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout') ) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Special Controller product -->
	<file name="catalog/controller/product/special.php">
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[ 
			if ($this->config->get('config_review_status')) {
			]]></search>
            <add trim="true"><![CDATA[
				if ((float)$result['quantity']) {
					$quantity = (int)$result['quantity'];
				} else {
					$quantity = false;
				}
			]]></add>
        </operation>
		
		<operation error="log"><!-- v15x -->
            <search position="before"><![CDATA[
			'href'        => $this->url->link('product/product', $url . '&product_id=' . $result['product_id'])
			]]></search>
            <add trim="true"><![CDATA[ 'quantity'   => $quantity, ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
	
	<!-- Remove from Special Product Template -->
	<file name="catalog/view/theme/*/template/product/special.tpl">
		<operation error="log"><!-- v15x -->
            <search position="replace"><![CDATA[
            <div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
            ]]></search>
            <add trim="true"><![CDATA[
            <?php if ($product['quantity'] == 0 || ($product['quantity'] < 0 && !$this->config->get('config_stock_checkout')) ) { ?>
			<div class="cart"><a onclick="return;" class="button"><span><?php echo $this->language->get('button_out_of_stock'); ?></span></a></div>
			<?php } elseif ($product['quantity'] < 0 && $this->config->get('config_stock_checkout') ) { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $this->language->get('button_pre_order'); ?></span></a></div>
			<?php } else { ?>
			<div class="cart"><a onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button"><span><?php echo $button_cart; ?></span></a></div>
			<?php } ?>
            ]]></add>
        </operation>
	</file>
	<!-- END BLOCK -->
 	
</modification>