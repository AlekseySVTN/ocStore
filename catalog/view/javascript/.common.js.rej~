--- catalog/view/javascript/common.js	(revision 357)
+++ catalog/view/javascript/common.js	(revision 358)
@@ -3,7 +3,7 @@
 	$('.button-search').bind('click', function() {
 		url = $('base').attr('href') + 'index.php?route=product/search';
 				 
-		var filter_name = $('input[name=\'filter_name\']').attr('value')
+		var filter_name = $('input[name=\'filter_name\']').attr('value');
 		
 		if (filter_name) {
 			url += '&filter_name=' + encodeURIComponent(filter_name);
@@ -12,11 +12,11 @@
 		location = url;
 	});
 	
-	$('#header input[name=\'filter_name\']').keydown(function(e) {
+	$('#header input[name=\'filter_name\']').bind('keydown', function(e) {
 		if (e.keyCode == 13) {
 			url = $('base').attr('href') + 'index.php?route=product/search';
 			 
-			var filter_name = $('input[name=\'filter_name\']').attr('value')
+			var filter_name = $('input[name=\'filter_name\']').attr('value');
 			
 			if (filter_name) {
 				url += '&filter_name=' + encodeURIComponent(filter_name);
@@ -27,20 +27,12 @@
 	});
 	
 	/* Ajax Cart */
-	$('#cart > .heading a').bind('click', function() {
+	$('#cart > .heading a').live('click', function() {
 		$('#cart').addClass('active');
 		
-		$.ajax({
-			url: 'index.php?route=checkout/cart/update',
-			dataType: 'json',
-			success: function(json) {
-				if (json['output']) {
-					$('#cart .content').html(json['output']);
-				}
-			}
-		});			
+		$('#cart').load('index.php?route=module/cart #cart > *');
 		
-		$('#cart').bind('mouseleave', function() {
+		$('#cart').live('mouseleave', function() {
 			$(this).removeClass('active');
 		});
 	});
@@ -94,11 +86,13 @@
 	});	
 });
 
-function addToCart(product_id) {
+function addToCart(product_id, quantity) {
+	quantity = typeof(quantity) != 'undefined' ? quantity : 1;
+
 	$.ajax({
-		url: 'index.php?route=checkout/cart/update',
+		url: 'index.php?route=checkout/cart/add',
 		type: 'post',
-		data: 'product_id=' + product_id,
+		data: 'product_id=' + product_id + '&quantity=' + quantity,
 		dataType: 'json',
 		success: function(json) {
 			$('.success, .warning, .attention, .information, .error').remove();
@@ -107,68 +101,21 @@
 				location = json['redirect'];
 			}
 			
-			if (json['error']) {
-				if (json['error']['warning']) {
-					$('#notification').html('<div class="warning" style="display: none;">' + json['error']['warning'] + '<img src="catalog/view/theme/default/image/close.png" alt="" class="close" /></div>');
-					
-					$('.warning').fadeIn('slow');
-					
-					$('html, body').animate({ scrollTop: 0 }, 'slow');
-				}
-			}	 
-						
 			if (json['success']) {
 				$('#notification').html('<div class="success" style="display: none;">' + json['success'] + '<img src="catalog/view/theme/default/image/close.png" alt="" class="close" /></div>');
 				
 				$('.success').fadeIn('slow');
 				
-				$('#cart_total').html(json['total']);
+				$('#cart-total').html(json['total']);
 				
 				$('html, body').animate({ scrollTop: 0 }, 'slow'); 
 			}	
 		}
 	});
 }
-
-function removeCart(key) {
-	$.ajax({
-		url: 'index.php?route=checkout/cart/update',
-		type: 'post',
-		data: 'remove=' + key,
-		dataType: 'json',
-		success: function(json) {
-			$('.success, .warning, .attention, .information').remove();
-			
-			if (json['output']) {
-				$('#cart_total').html(json['total']);
-				
-				$('#cart .content').html(json['output']);
-			}			
-		}
-	});
-}
-
-function removeVoucher(key) {
-	$.ajax({
-		url: 'index.php?route=checkout/cart/update',
-		type: 'post',
-		data: 'voucher=' + key,
-		dataType: 'json',
-		success: function(json) {
-			$('.success, .warning, .attention, .information').remove();
-			
-			if (json['output']) {
-				$('#cart_total').html(json['total']);
-				
-				$('#cart .content').html(json['output']);
-			}			
-		}
-	});
-}
-
 function addToWishList(product_id) {
 	$.ajax({
-		url: 'index.php?route=account/wishlist/update',
+		url: 'index.php?route=account/wishlist/add',
 		type: 'post',
 		data: 'product_id=' + product_id,
 		dataType: 'json',
@@ -176,13 +123,13 @@
 			$('.success, .warning, .attention, .information').remove();
 						
 			if (json['success']) {
-				$('#notification').html('<div class="success" style="display: none;">' + json['success'] + '<img src="catalog/view/theme/default/image/close.png" alt="" class="close" /></div>');
+				$('#notification').after('<div class="success" style="display: none;">' + json['success'] + '<img src="catalog/view/theme/default/image/close.png" alt="" class="close" /></div>');
 				
 				$('.success').fadeIn('slow');
 				
-				$('#wishlist_total').html(json['total']);
+				$('#wishlist-total').html(json['total']);
 				
-				$('html, body').animate({ scrollTop: 0 }, 'slow'); 				
+				$('html, body').animate({ scrollTop: 0 }, 'slow');
 			}	
 		}
 	});
@@ -190,7 +137,7 @@
 
 function addToCompare(product_id) { 
 	$.ajax({
-		url: 'index.php?route=product/compare/update',
+		url: 'index.php?route=product/compare/add',
 		type: 'post',
 		data: 'product_id=' + product_id,
 		dataType: 'json',
@@ -202,10 +149,10 @@
 				
 				$('.success').fadeIn('slow');
 				
-				$('#compare_total').html(json['total']);
+				$('#compare-total').html(json['total']);
 				
 				$('html, body').animate({ scrollTop: 0 }, 'slow'); 
 			}	
 		}
 	});
-}
+}